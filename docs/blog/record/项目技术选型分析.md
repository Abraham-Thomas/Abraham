# 项目技术选型分析

## 构建工具

gulp、grunt——任务管理，gulp属于流式（IO），grunt先读取再写入，前者相对效率更高。

webpack——打包。

fis——百度内部推荐的集成方案。

prepack——Facebook推出的代码优化方案，无DOM、BOM

rollup——打包。

**为什么要构建工具？**

- 资源压缩，减少体积。
- 静态资源替换，性能优化，减少HTTP请求。
- 模块化处理。
- 编译处理。babel

## NVVM框架的选择

Vue、React、Angular，目前三者本质上已经没有区别，根据团队选择。

## 模块化与自适应设计

不仅仅是JS，还包括CSS。

CSS像素（逻辑像素）：px。

设备像素（物理像素）：和逻辑像素成一定的比。

**viewport：** 

属性：

- width：控制viewport的大小，可以指定一个值，或设备宽度——device-width。
- height：和width对应，高度。
- initial-scale：初始缩放比例，也即是当页面第一次load的时候缩放比例。
- maximum/minimum--scale：允许用户缩放的最大/最小比例。
- user-scalable：用户是否可以手动缩放。

```javascript
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,minimal-ui">
```

**rem：** 相对于html标签的font-size的相对大小。而em则相对于父元素。

利用viewport和设备像素比调整基准像素。

利用px2rem自动转换CSS单位。

## SPA设计

**意义：**

前后端分离。

减轻服务器压力。

增强用户体验。

Prerender预渲染优化SEO。

**工作原理：**

History API——实现方式更加优雅，但对浏览器有一定要求。

- 通过不同入口打开对应页面，执行打开动作。
- 拥有历史记录操作单。
- pushState：创建历史记录
- onpopState：响应浏览器的事件

![图解](/images/HistoryApi.png)

```javascript
<a class="api a">a.html</a>
<a class="api b">b.html</a>

<script type="text/javascript">
    // 注册路由
    document.querySelectorAll('.api').forEach(item=>{
      item.addEventListener('click',(e)=>{
        e.preventDefault();
        let link=item.textContent;
        window.history.pushState({name:'api'},link,link);
      },false)
    });

    // 监听路由
    window.addEventListener('popstate',(e)=>{
      console.log({
        location:location.href,
        state:e.state
      });
    },false)
</script>
```

Hash——兼容性比较好。

每个页面对应hash，通过hash的变换监听事件，最终完成页面的切换。

![](/images/hash.png)

```javascript
// 注册路由
    document.querySelectorAll('.hash').forEach(item=>{
      item.addEventListener('click',(e)=>{
        e.preventDefault();
        let link=item.textContent;
        location.hash=link;
      },false)
    });

    // 监听路由
    window.addEventListener('hashchange',(e)=>{
      console.log({
        location:location.href,
        hash:location.hash
      });
    },false)
```

